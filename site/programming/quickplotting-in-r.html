<head>
  <meta charset='utf-8' />
  <meta content='width=device-width, initial-scale=1' name='viewport' />
  <meta content='Musings of a free mind, treasured recollections, and visions of a distant future. Short notes on biology, programming, and science!' name='description' />
  <meta content='Vivek Rai' name='author' />
  <link href='/css/normalize.css' rel='stylesheet' />
  <link href='/css/styles.css' rel='stylesheet' />
  <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css' rel='stylesheet' />
  <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville' rel='stylesheet' />
  <link href='https://fonts.googleapis.com/css?family=Satisfy' rel='stylesheet' />
  <link href='/css/codehilite.css' rel='stylesheet' />
  <title>Quick Data Plotting in R | Shorts by Vivek Rai</title>

</head>
<body>
  <div class='container'>
    <div class='banner no-print'>
  <div class='banner-title'>
    <a href='https://raivivek.in/'>Shorts</a>
  </div>
  <div class='banner-subclause'>
    <i> Musings of a Free Mind, Recollections &amp; <br> Visions of the Distant Future </i>
  </div>
  <div class='archive'>
    <a href='../science.html'>science,</a>
    <a href='../programming.html'>programming,</a>
    <a href='../notes.html'>notes,</a>
    <a href='../books.html'>books,</a>
    <a href='../unfinished.html'>unfinished,</a>
    <a href='../quotes.html'>quotes,</a>
    <a href='../about.html'>about</a>
  </div>

</div>
    <div id='main' class='content'>
      <article>
        <div class='metadata'>
          <div class='category'>
            <a href='../programming.html'>
              programming
            </a>
          </div>
          <div class='timestamp'>
            20 May 2016
          </div>
        </div>
        <div class='title'>
          <a href='../programming/quickplotting-in-r.html#main'>
            Quick Data Plotting in R
          </a>
        </div>
        <div class='post'>
          <p>Python is my all time favorite programming language. I use it all the time. It
is simple, readable and easy to get started, something which I picked up four
years ago when I went through the first offering of <em>Interactive Programming
with Python</em> course on Coursera. Python’s simplicity and appeal has continued to
grow over time, supported by a wide community and a rich environment of
packages.</p>
<p>Today, however, I am not going to talk about Python. This post shares some of my
experiences with <a href="https://www.r-project.org/">R programming language</a> and how it helped me postpone my
struggle with visualizations in Python (a short back-story at the end).</p>
<p>Plotting figures is real quick. An example below using the famous <a href="https://www.kaggle.com/c/titanic/data">Titanic</a>
dataset from <a href="http://kaggle.com">Kaggle</a> competition.</p>
<div class="codehilite"><pre><span></span>data <span class="o">&lt;-</span> read.table<span class="p">(</span>‘data.txt’<span class="p">,</span> header<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="c1"># TSV file</span>
<span class="kp">names</span><span class="p">(</span>d<span class="p">)</span> <span class="c1"># fetch columns</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="s">&quot;PassengerId&quot;</span> <span class="s">&quot;Survived&quot;</span>   <span class="s">&quot;Pclass&quot;</span>    <span class="s">&quot;Name&quot;</span>        <span class="s">&quot;Sex&quot;</span>
<span class="p">[</span><span class="m">6</span><span class="p">]</span>  <span class="s">&quot;Age&quot;</span>         <span class="s">&quot;SibSp&quot;</span>      <span class="s">&quot;Parch&quot;</span>     <span class="s">&quot;Ticket&quot;</span>      <span class="s">&quot;Fare&quot;</span>
<span class="p">[</span><span class="m">11</span><span class="p">]</span> <span class="s">&quot;Cabin&quot;</span>       <span class="s">&quot;Embarked&quot;</span>
</pre></div>


<p>Looking at the columns, it would be interesting to explore the age distribution
of the people, along with their survivor, class and sex distribution. Let’s take
a look.</p>
<div class="codehilite"><pre><span></span>boxplot<span class="p">(</span>Age <span class="o">~</span> <span class="kp">as.factor</span><span class="p">(</span>Pclass<span class="p">),</span> data<span class="o">=</span>data<span class="p">)</span>
title<span class="p">(</span>xlab<span class="o">=</span><span class="s">&#39;Class&#39;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&#39;Age&#39;</span><span class="p">,</span> main<span class="o">=</span><span class="s">&#39;Passenger age vs Class&#39;</span><span class="p">)</span>
abline<span class="p">(</span>h<span class="o">=</span>median<span class="p">(</span>data_Age<span class="p">,</span> na.rm <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span> col<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
</pre></div>


<p>Boxplot is a good way to visualize the age distribution across passenger classes.</p>
<figure>
<img
    src="/images/class_age.png"
    title="Boxplot demo"/>
<figcaption>
 The <span style='color: red;'>red</span> indicates overall age media while the
 individual class-wise median ages are displayed in thick <b>black</b> lines.
</figcaption>
</figure>

<p>The histogram below is generated in a single line.</p>
<figure>
<img
  src="/images/hist.png"
  title="A quick histogram."/>
<figcaption> A quick histogram with some fancy colors, if you will. </figcaption>
</figure>

<p>While it may take a bit of time to find out which functions to use (most of the
times they have intuitive names), it becomes super easy to generate complex
figures by simply composing simple ones.</p>
<p>Also, when handling a large amount of data, plotting with a few tweaked
parameters can save quite a bit of processing time. A few of these suggestions
and helpful functions are compiled below with relevant examples.</p>
<h3 id="functions">Functions</h3>
<ul>
<li><code>ifelse()</code> - inline conditional</li>
</ul>
<div class="codehilite"><pre><span></span>col <span class="o">&lt;-</span> <span class="kp">ifelse</span><span class="p">(</span>dataSurvived <span class="o">==</span> <span class="m">1</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;gray&#39;</span><span class="p">))</span>
</pre></div>


<ul>
<li><code>boxplot()</code> - boxplot, demo above</li>
</ul>
<div class="codehilite"><pre><span></span>boxplot<span class="p">(</span>Age <span class="o">~</span> <span class="kp">as.factor</span><span class="p">(</span>Pclass<span class="p">),</span> data<span class="o">=</span>data<span class="p">)</span>
</pre></div>


<ul>
<li><code>split()</code> - split dataframe, useful with <code>boxplot</code></li>
</ul>
<div class="codehilite"><pre><span></span>df <span class="o">&lt;-</span> <span class="kp">split</span><span class="p">(</span>data<span class="o">-</span>Age<span class="p">,</span> f<span class="o">=</span><span class="s">&#39;Pclass&#39;</span><span class="p">)</span>
</pre></div>


<ul>
<li><code>hsv()</code> - generate colors</li>
</ul>
<div class="codehilite"><pre><span></span>cols <span class="o">&lt;-</span> hsv<span class="p">((</span><span class="m">2</span><span class="o">/</span><span class="m">3</span><span class="p">)</span><span class="o">*</span><span class="kp">as.integer</span><span class="p">(</span>data<span class="o">-</span>Pclass<span class="p">)</span><span class="o">/</span><span class="m">25</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">7</span><span class="o">/</span><span class="m">8</span><span class="p">)</span>
</pre></div>


<ul>
<li><code>points()</code> - draw points on a graph</li>
</ul>
<div class="codehilite"><pre><span></span>points<span class="p">(</span>data<span class="o">$</span>Age<span class="p">,</span> col<span class="o">=</span><span class="kp">ifelse</span><span class="p">(</span>dataSibSp <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="kc">NA</span><span class="p">))</span>
</pre></div>


<ul>
<li><code>abline()</code> - draw a line on the graph given by <code>y=a+bx</code></li>
</ul>
<div class="codehilite"><pre><span></span>abline<span class="p">(</span>h<span class="o">=</span>median<span class="p">(</span>dataAge<span class="p">),</span> na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<ul>
<li><code>par()</code>, <code>layout()</code> - set graph properties, split the graph</li>
</ul>
<div class="codehilite"><pre><span></span>layout<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">))</span> <span class="c1"># split the graph in 2 rows</span>
</pre></div>


<ul>
<li><code>title(), text(), legend()</code> - set graph title, axes labels, legends etc</li>
<li><code>qqplot()</code> - a <a href="http://onlinestatbook.com/2/advanced_graphs/q-q_plots.html">quantile-quantile plot</a></li>
</ul>
<h3 id="tricks">Tricks</h3>
<ul>
<li>Use <code>pch='.'</code> in <code>plot</code> commands to use dots in place of big circles. This saves a lot of time especially if there are many points. In case points are too small to see, use <code>cex=2</code> or higher to increase the point size. Use <code>par(pch='.')</code> to set the behavior for all plots.</li>
</ul>
<div class="codehilite"><pre><span></span>plots<span class="p">(</span>dataAge<span class="p">,</span> pch<span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>


<ul>
<li>Use <code>data.table</code> library to load very large tables quickly. This could be upto 10x faster than default <code>read.table</code> function of R. Read more <a href="https://github.com/vivekiitkgp/til/blob/master/misc/r-large-data.md">here</a>.</li>
</ul>
<hr />
<p><em>Background</em></p>
<p><small>
This post is an outgrowth of my struggle with generating exploratory
visualizations in Python. While using <code>pandas</code>, <code>scipy</code> and <code>numpy</code> combination
is a natural and super effective combination, visualization with <code>matplotlib</code>
or its alternatives like <code>seaborn</code> is equally confusing. The documentation is
too verbose and often there are many ways to do the same thing. While R is not
without its own flaws, I was awestruck with the simplicity and ease of use in
getting started with it (at least for the purpose I was interested in). All
thanks to senior researcher Max.</p>
<p>For the curious, I was analyzing several gigabytes of derivative data obtained
from whole-genomes sequences of thousands of humans. Using the scipy stack
above, combined with the power of <code>multiprocessing</code> module, I could spawn 16
processes on the multi-core cluster and reduced the processing time from 35 min
to 2 min. A big win!</p>
<p>However, I do hope to eventually return to Python stack and figure out things
with a cool head.  Who knows if that’s going to be my next blog post.
</small></p>
        </div>
        <div class='share'>
          Enjoyed the story? <br>
          <a class='twitter-share-button' data-dnt='true' data-via='vivek_ziel' data-text='Quick Data Plotting In R: Shorts by Vivek Rai' href='https://twitter.com/share' data-hashtags='programming'>tweet |&nbsp;</a>
          <a class='twitter-follow-button' data-show-screen-name='false' data-dnt='true' data-show-count='false' href='https://twitter.com/vivek_ziel'>follow @vivek_ziel</a>

        </div>
      </article>
    </div>
  </div>
  
  <script>
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');

  </script>
</body>